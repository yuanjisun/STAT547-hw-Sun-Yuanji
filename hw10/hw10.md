Homework 10
================
Yuanji Sun
December 6, 2017

``` r
library(tidyverse)
```

    ## -- Attaching packages --------------------------------------------------------------------------------- tidyverse 1.2.1 --

    ## v ggplot2 2.2.1     v purrr   0.2.4
    ## v tibble  1.3.4     v dplyr   0.7.4
    ## v tidyr   0.7.2     v stringr 1.2.0
    ## v readr   1.1.1     v forcats 0.2.0

    ## -- Conflicts ------------------------------------------------------------------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(magrittr)
```

    ## 
    ## Attaching package: 'magrittr'

    ## The following object is masked from 'package:purrr':
    ## 
    ##     set_names

    ## The following object is masked from 'package:tidyr':
    ## 
    ##     extract

``` r
library(purrr)
library(glue)
```

    ## 
    ## Attaching package: 'glue'

    ## The following object is masked from 'package:dplyr':
    ## 
    ##     collapse

``` r
library(stringr)
library(rvest)
```

    ## Loading required package: xml2

    ## 
    ## Attaching package: 'rvest'

    ## The following object is masked from 'package:purrr':
    ## 
    ##     pluck

    ## The following object is masked from 'package:readr':
    ## 
    ##     guess_encoding

``` r
library(xml2)
library(ggplot2)
```

1.  Cannot knit
2.  For loop, display figures and save in report
3.  figure title, axis change, figure not change
4.  store figures in row and column
5.  API? API Key?
6.  hw7 grade

Part 1:
=======

Step 1: Get the URL of the data set and store the URL contents to a variable.

``` r
url <- "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092111.0"
page_title <- read_html(url)
```

Step 2: Extract the data in the text form.

``` r
txt_data <- xml_text(page_title)
```

Step 3: Convert the text data into a dataframe.

``` r
data <- read.table(text=txt_data,skip=1,col.names=c('event','sta', "cast", "date", "time", "lat_begin", "lon_begin",
                                                    "bot", "press","temp", "sal_bot","O2_ml_L", "O2_umol_kg",
                                                    "O2_umol_L", "O2_4", "NO3", "PO4", "SiO4", "NO2", "NH4"))
data$depth <- -data$press
```

Step 4: Generate figures for selected variable vs `press`. `press` can be taken as depth.

``` r
plot_list = list()
for (i in 16:20) {
        variable <- colnames(data)[i]
        plot_list[[i-15]] <- ggplot(data=data, mapping=aes_string(x=variable, y="depth")) +
            geom_point() +
            geom_path() +
                labs(x = colnames(data)[i], y = "Depth (m)")
}
```

Part 2
======

Step 1: Get the URL of all data set, which contains lots of links of detailed data (just like the data in Part 1).

``` r
main_URL <- "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.html0%7Bdir=usjgofs.whoi.edu/jg/dir/jgofs/arabian/ttn-039/,info=usjgofs.whoi.edu/jg/info/jgofs/arabian/ttn-039/bottle%7D"
```

Step 2: Extract event numbers in the webpage. All data in the dataframe are stored in character form.

``` r
main_page_title <- read_html(main_URL)
raw_info <- main_page_title %>% xml_text()
info <- read.table(text=raw_info,skip=13,col.names=c("event", "sta", "cast", "date", "time", "lat_begin",
                                                        "lon_begin"), colClasses = "character")
event <- info$event
```

Step 3: Modify the event number by adding `20` before the number. This is because the link of the data ending with `20` + event numbers.

``` r
for (i in 1:length(event)){
      event[i] <- paste("20", event[i], sep = "")
}
```

Step 4: Generating URLs for all data webpage. The URL has the commmon format, "[http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%](http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%)" + event number. Let's have a look at all websites and check some of them.

``` r
sub_URL = ""
for (i in 1:length(event)){
      sub_URL[i] <- paste("http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%",
                          event[i], sep = "")
}
sub_URL
```

    ##  [1] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092111.0"
    ##  [2] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092601.7"
    ##  [3] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092616.7"
    ##  [4] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092620.2"
    ##  [5] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092621.3"
    ##  [6] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092702.1"
    ##  [7] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092708.0"
    ##  [8] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092714.1"
    ##  [9] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092720.5"
    ## [10] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092801.7"
    ## [11] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092809.7"
    ## [12] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092802.2"
    ## [13] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092903.9"
    ## [14] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20092920.2"
    ## [15] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20093007.4"
    ## [16] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20093017.9"
    ## [17] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100100.4"
    ## [18] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100110.4"
    ## [19] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100116.0"
    ## [20] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100200.1"
    ## [21] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100204.1"
    ## [22] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100208.7"
    ## [23] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100211.6"
    ## [24] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100214.0"
    ## [25] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100215.2"
    ## [26] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100223.6"
    ## [27] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100311.6"
    ## [28] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100322.0"
    ## [29] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100323.3"
    ## [30] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100408.3"
    ## [31] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100419.3"
    ## [32] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100504.3"
    ## [33] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100506.8"
    ## [34] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100508.4"
    ## [35] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100514.2"
    ## [36] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100517.4"
    ## [37] "http://usjgofs.whoi.edu/jg/serv/jgofs/arabian/ttn-039/bottle.flat1?event%20eq%20100606.5"

Step 5. Analyze all data from different webpages at the same time. The idea is to put what I did in Part 1 in a loop and generate figures automatically.

``` r
plot_list = list()
for  (i in 1:length(sub_URL)){
        page_title <- read_html(sub_URL[i])
        print(i)
        txt_data <- xml_text(page_title)
        data <- read.table(text=txt_data,skip=1,col.names=c('event','sta', "cast", "date", "time", "lat_begin",
                                                            "lon_begin","bot", "press","temp", "sal_bot","O2_ml_L",
                                                            "O2_umol_kg","O2_umol_L", "O2_4", "NO3", "PO4", "SiO4",
                                                            "NO2", "NH4"), na.strings = "nd")

        data$depth <- -data$press

        plot_list[[i]] <- list()
        for (j in 16:20) {
            print(j)
            
                variable <- colnames(data)[j]
                print(variable)
                data[[variable]] <- as.numeric(data[[variable]])
                plot_list[[i]][[j-15]] <- ggplot(data=data, mapping=aes_string(x=variable, y="depth")) +
                        geom_point() +
                        labs(x = colnames(data)[j], y = "Depth (m)", title = paste("Event", event[i], sep = " "))
        }
}
```

    ## [1] 1
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 2
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 3
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 4
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 5
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 6
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 7
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 8
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 9
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 10
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 11
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 12
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 13
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 14
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 15
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 16
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 17
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 18
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 19
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 20
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 21
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 22
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 23
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 24
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 25
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 26
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 27
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 28
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 29
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 30
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 31
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 32
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 33
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 34
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 35
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 36
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
    ## [1] 37
    ## [1] 16
    ## [1] "NO3"
    ## [1] 17
    ## [1] "PO4"
    ## [1] 18
    ## [1] "SiO4"
    ## [1] 19
    ## [1] "NO2"
    ## [1] 20
    ## [1] "NH4"
